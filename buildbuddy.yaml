actions:
  - name: "Build and Test all targets"
    container_image: "ubuntu-20.04"
    triggers:
      push:
        branches:
          - "master" # <-- replace "main" with your main branch name
      pull_request:
        branches:
          - "*"
    steps:
      # TODO(#209): Don't require installing this
      - run: 'sudo apt-get install -y graphviz graphviz-dev'
      - run: 'build //...'
      - run: 'test //...'
      - run: 'coverage //... --combined_report=lcov --instrument_test_targets --instrumentation_filter="^//" --test_size_filters=-enormous'
    resource_requests:
      # The default 20GB was too small
      disk: 40GB
